{% extends "base.html" %}
{% block content %}
<div class="page-header">
<h1>Assign Competence</h1>
</div>


<div class="row">
    <div class="col-md-2"></div>
    <div class="col-md-8">
        <div class="well bs-component">
            <form action="{{ url_for('competence.assign_competences_to_user') }}?ids={{ ids }}" method="POST" class="form-horizontal">
                <fieldset>
                    <legend>Choose User (or multiple users!)</legend>

                    <div class="form-group">
                    <div class="col-lg-12">
                    <strong>Competencies:</strong> {{competences}}
                    </div>
                    </div>
                    <div class="form-group">
                        {{ form.full_name.label(class_="col-lg-2 control-label") }}

                        <div class="col-lg-10">
                            <div class="input-group">
                            {{ form.full_name(class_="form-control") }}

                            <span class="input-group-btn"><button class="btn btn-primary" id="add_user"
                                                                      type="button">Assign</button></span>
                                </div>
                             <span class="help-block"><strong>Start typing and users will appear.</strong></span>
                            <span class="help-block">These competence will be <strong>Assigned</strong>, but not <strong>Activated</strong>. Once the staff member commences this competence it will become active.</span>
                            <div id="selected_users"></div>
                            <input type="text" id="user_list" name="user_list" hidden required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-10 col-lg-offset-2">
                            {{ form.submit(class_="btn btn-primary") }}
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
    <div class="col-md-2"></div>
</div>

<script>




    function addUser() {
        console.log('hello')
        previous_value = $('#user_list').val()
        if (previous_value == "") {
            sep = ''
        } else {
            sep = ','
        }

        $('#user_list').val(previous_value + sep + $('#full_name').val() )

        $('#selected_users').val( $('#add_document').val() )
        $('#selected_users').append('<a href="#" class="btn btn-success remove" id="remove_document" >' + $('#full_name').val() + ' <span class="glyphicon glyphicon-remove"></span> </a> ')
        $('#full_name').val('')

    };

    $('#add_user').click(function(){ addUser() });

    $("#full_name").keydown(function (e) {
        if (e.key == 'Enter') {
            e.preventDefault()
            addUser()
        }

    });

    $(document).on("click", '.remove' ,function(){
        console.log("HELLO");
        var docs = $('#user_list').val().split(',');
        console.log(docs);
        docs.splice( $.inArray($(this).attr('user_list'), docs),1  );
        console.log(docs);
        $('#user_list').val(docs.join());
        $(this).remove();
    });

    $(function () {
        $.ajax({
            url: '{{ url_for("autocomplete") }}'
        }).done(function (data) {
            $('#full_name').autocomplete({
                source: data.json_list,
                minLength: 2

            });
        });
    });
</script>

{% endblock %}